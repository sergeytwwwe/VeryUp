-- loader.lua: Основной загрузчик
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Загрузка VeryUpNotifications
local showNotification = loadstring(game:HttpGet("https://raw.githubusercontent.com/sergeytwwwe/VeryUp/refs/heads/main/VeryUpNotifications"))()

-- Загрузка VeryUpLoadingScreen
local createLoader = loadstring(game:HttpGet("https://raw.githubusercontent.com/sergeytwwwe/VeryUp/refs/heads/main/VeryUpLoadingScreen"))()
local updateLoader, hideLoader = createLoader()

-- Проверка на повторный инжект лоадера
if getgenv().VeryUpLoaderInjected then
    showNotification("Error: Loader is already injected!", true)
    if game.CoreGui:FindFirstChild("LoaderGui") then
        game.CoreGui.LoaderGui:Destroy()
    end
    return
end

-- Устанавливаем флаг инжекта лоадера
getgenv().VeryUpLoaderInjected = true

-- Проверка GameId
if game.GameId ~= 5369242581 then
    showNotification("This game is not supported!", true)
    if game.CoreGui:FindFirstChild("LoaderGui") then
        game.CoreGui.LoaderGui:Destroy()
    end
    return
end

-- Реальная загрузка ReGui
local progress = 0
updateLoader(progress)

local ReGui, PrefabsId
local success, errorMsg = pcall(function()
    ReGui = loadstring(game:HttpGet('https://raw.githubusercontent.com/depthso/Dear-ReGui/refs/heads/main/ReGui.lua'))()
    PrefabsId = "rbxassetid://" .. ReGui.PrefabsId
end)

if not success then
    warn("Failed to load ReGui: " .. errorMsg)
    if game.CoreGui:FindFirstChild("LoaderGui") then
        game.CoreGui.LoaderGui:Destroy()
    end
    return
end

-- Имитация прогресса загрузки
local totalSteps = 20
local step = 100 / totalSteps
local currentStep = 0

coroutine.wrap(function()
    while currentStep < totalSteps do
        wait(0.1)
        currentStep = currentStep + 1
        progress = math.min(currentStep * step, 100)
        updateLoader(progress)
    end

    -- Загрузка UI после достижения 100%
    local InsertService = game:GetService("InsertService")
    ReGui:Init({
        Prefabs = InsertService:LoadLocalAsset(PrefabsId)
    })

    -- Основное окно с вкладками
    local TabsWindow = ReGui:TabsWindow({
        Title = "Чит для Roblox",
        Size = UDim2.fromOffset(400, 300),
        NoScroll = true
    })

    local VisualTab = TabsWindow:CreateTab({Name = "Visual"})
    local CombatTab = TabsWindow:CreateTab({Name = "Combat"})
    local MiscTab = TabsWindow:CreateTab({Name = "Misc"})
    local SettingsTab = TabsWindow:CreateTab({Name = "Settings"})

    -- Экспортируем вкладки для использования в скриптах
    getgenv().VisualTab = VisualTab
    getgenv().CombatTab = CombatTab
    getgenv().MiscTab = MiscTab
    getgenv().SettingsTab = SettingsTab
    getgenv().RunService = RunService

    -- Загрузка ESP через GitHub
    local esp = loadstring(game:HttpGet("https://raw.githubusercontent.com/sergeytwwwe/VeryUp/refs/heads/main/VeryUpESP"))()
    esp:Load()

    -- Загрузка Combat через GitHub
    local combat = loadstring(game:HttpGet("https://raw.githubusercontent.com/sergeytwwwe/VeryUp/refs/heads/main/VeryUpCombat"))()

    -- Установка флага инжекта
    getgenv().VeryUpInjected = true

    -- Исчезновение лоадера и показ уведомлений
    hideLoader(function()
        showNotification("Success! Your username: " .. LocalPlayer.Name, false)
        showNotification("Success! You are in game: " .. MarketplaceService:GetProductInfo(game.PlaceId).Name, false)
        showNotification("Success: VeryUp Cheat has been injected!", false)
    end)
end)()
