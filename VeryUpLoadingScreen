local CoreGui = game:GetService("CoreGui")

local function createLoader()
    -- Проверяем и удаляем старый LoaderGui
    if CoreGui:FindFirstChild("LoaderGui") then
        CoreGui.LoaderGui:Destroy()
    end

    local loaderGui = Instance.new("ScreenGui")
    loaderGui.Name = "LoaderGui"
    loaderGui.Parent = CoreGui
    loaderGui.IgnoreGuiInset = true
    loaderGui.ResetOnSpawn = false

    local loaderFrame = Instance.new("Frame")
    loaderFrame.Size = UDim2.new(0, 300, 0, 100)
    loaderFrame.Position = UDim2.new(0.5, -150, 0.5, -50)
    loaderFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    loaderFrame.BorderSizePixel = 0
    loaderFrame.Parent = loaderGui

    local loadingLabel = Instance.new("TextLabel")
    loadingLabel.Size = UDim2.new(1, -20, 0, 30)
    loadingLabel.Position = UDim2.new(0, 10, 0, 10)
    loadingLabel.BackgroundTransparency = 1
    loadingLabel.Text = "Loading..."
    loadingLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    loadingLabel.TextSize = 20
    loadingLabel.Font = Enum.Font.GothamBold
    loadingLabel.Parent = loaderFrame

    local percentLabel = Instance.new("TextLabel")
    percentLabel.Size = UDim2.new(1, -20, 0, 30)
    percentLabel.Position = UDim2.new(0, 10, 0, 50)
    percentLabel.BackgroundTransparency = 1
    percentLabel.Text = "0%"
    percentLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    percentLabel.TextSize = 18
    percentLabel.Font = Enum.Font.Gotham
    percentLabel.Parent = loaderFrame

    local function updateLoader(progress)
        if typeof(progress) ~= "number" then progress = 0 end
        progress = math.clamp(progress, 0, 100)
        percentLabel.Text = math.floor(progress) .. "%"
    end

    local function hideLoader(callback)
        if loaderGui then
            loaderGui:Destroy()
        end
        if callback then callback() end
    end

    return updateLoader, hideLoader
end

return createLoader
